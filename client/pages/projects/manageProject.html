<head>
	<script src="https://cdn.ckeditor.com/4.7.0/standard/ckeditor.js"></script>
</head>
<template name="manageProject">

	{{#with data}}

	{{> title title='Проекты'  item1='/projects' item1name='Проекты' item2name=name  item1name='Проекты'}}

	<div class="uk-margin-small uk-padding-small" >


		{{#if isReady}}
		<div class="uk-width-1-1">
			<div class="uk-grid-small" uk-grid>
				<div class="uk-width-1-4 ">
					<div class="uk-card  uk-margin uk-card-body uk-card-primary">
						<h4>{{name}}</h4>
						<h5 class="uk-margin-small">Время до окончания проекта:</h5>
						<div class="uk-grid-small uk-child-width-auto" uk-grid uk-countdown="date: {{deadline._d}}">
							<div>
								<div class="uk-countdown-number uk-countdown-days"></div>
								<div class="uk-countdown-label uk-margin-small uk-text-center uk-visible@s">Дней</div>
							</div>
							<div class="uk-countdown-separator">:</div>
							<div>
								<div class="uk-countdown-number uk-countdown-hours"></div>
								<div class="uk-countdown-label uk-margin-small uk-text-center uk-visible@s">Часов</div>
							</div>
							<div class="uk-countdown-separator">:</div>
							<div>
								<div class="uk-countdown-number uk-countdown-minutes"></div>
								<div class="uk-countdown-label uk-margin-small uk-text-center uk-visible@s">Минут</div>
							</div>
							<div class="uk-countdown-separator">:</div>
							<div>
								<div class="uk-countdown-number uk-countdown-seconds"></div>
								<div class="uk-countdown-label uk-margin-small uk-text-center uk-visible@s">Секунд</div>
							</div>
						</div>
						{{#if isAdmin}}
							<h5>Изменить дедлайн <input type="date" id="chdeadline" class="uk-float-right"></h5>
						{{/if}}

					</div>

					{{#if isAdmin}}
					<div class="uk-card  uk-card-default uk-margin-top">
						<div class="uk-card-body">

							{{#if $eq currentUser.roles 'admin'}}
							<div class="uk-margin">
								<label class="uk-form-label" for="manager">Менеджер</label>
								<select  class="uk-select" id="manager">
									<option value="" ></option>
									{{#each managers}}
									<option value="{{_id}}" selected="{{$eq _id data.manager}}">{{name}}</option>
									{{/each}}
								</select>
								<div class="selectize_fix"></div>
							</div>
							{{/if}}

							<div class="uk-margin">
								<label class="uk-form-label" for="desinger">Ведущий дизайнер</label>
								<select  class="uk-select" id="desinger">
									<option value="" ></option>
									{{#each managers}}
									<option value="{{_id}}" selected="{{$eq _id data.desinger}}">{{name}}</option>
									{{/each}}
								</select>
								<div class="selectize_fix"></div>
							</div>

							<div class="uk-margin">
								<label class="uk-form-label" for="developer">Ведущий программист</label>
								<select  class="uk-select" id="developer">
									<option value="" ></option>
									{{#each managers}}
									<option value="{{_id}}" selected="{{$eq _id data.developer}}">{{name}}</option>
									{{/each}}
								</select>
								<div class="selectize_fix"></div>
							</div>
						</div>
					</div>
					{{/if}}

					<div class="uk-card uk-card-default uk-margin">
						<div class="uk-card-header">Задачи</div>
						<div class="timeline list-expandable uk-card-body">

							<ul class="uk-list">

								{{#sortable items=tasks sortField="order" animation="100" }}
									<li class="uk-grid-collapse task" id="{{_id}}" uk-grid style="cursor: move;">

										<div class="uk-width-1-5 uk-inline">
											{{#if status}}<span uk-icon="icon: check; ratio:1.1" class="uk-position-center-left"></span>{{else}}
											<span uk-icon="icon: clock; ratio:1.5" class="uk-position-center-left"></span>{{/if}}
										</div>

										<div class="uk-width-4-5">
											<a class="" href="{{pathFor 'task-item' id=_id}}">{{name}}</a>
											<progress id="progressbar" class="uk-progress uk-float-right" value="{{progr _id}}" max="100"></progress>
										</div>
									</li>

								{{/sortable}}
							</ul>


						</div>
					</div>


				</div>


				<div class="uk-width-3-4">
					<div class="uk-card uk-card-default">

						<div class="uk-card-header uk-inline uk-width-1-1">
							<h4 class=" ">
								Детали
							</h4>
							<div class="uk-position-center-right uk-position-small">
								{{#if $eq user currentUser._id}}
									<a class='offer uk-button uk-button-primary uk-button-small'>Договор </a>
								{{/if}}
								{{#if isAdmin}}
									<a class='offer uk-button uk-button-primary uk-button-small'>Договор </a>
								{{/if}}
								<a class='teh uk-button uk-button-primary uk-button-small'>Техзадание </a>
							</div>
						</div>

						<div class="uk-card-body uk-form-stacked">
							<div class="uk-grid uk-grid-divider uk-grid-medium" uk-grid>
								<div class="uk-width-1-2">

									<div class="uk-margin">
										<label class="uk-form-label" for="name">Название:</label>
										<div class="uk-form-controls">
											<input type="text" class="uk-input uk-form-blank uk-form-width-1-1 uk-form" id="name"  value="{{name}}">
										</div>
									</div>
								</div>

								<div class="uk-width-1-2">

									<div class="uk-margin">
										<label class="uk-form-label" for="short">Описание:</label>
										<div class="uk-form-controls">
											<textarea id="short" class="uk-input uk-form-blank uk-form-width-1-1" rows="3">{{short}}</textarea>
										</div>
									</div>
								</div>

								<div class="uk-margin uk-width-1-1">
									<label class="uk-form-label" for="short">Анкета проекта</label>
									<div class="uk-form-controls">
										<textarea id="description" cols="30" rows="40">{{{brif}}}</textarea>
									</div>
									<button class="uk-button uk-button-small uk-button-primary" id="descriptionsave">Cохранить</button>
								</div>
							</div>
						</div>
					</div>


					<div class="uk-card uk-card-default uk-margin">

							<div class="uk-card-header uk-inline uk-width-1-1">
								<h4 class=" ">
									Обсуждение
								</h4>
							</div>

							<div class="uk-form-stacked">
								{{>SimpleChatWindow roomId=data.room username=currentUser.username name=currentUser.name allow=true beep=true button='Написать' placeholder='Сообщение' avatar=currentUser.avatar }}
							</div>
						</div>

				</div>

			</div>
		</div>
		{{else}}
		{{> loading}}
		{{/if}}

	</div>

	{{/with}}

</template>
