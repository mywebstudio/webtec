<head>
	<script src="/js/ckeditor/ckeditor.js"></script>
</head>
<template name="manageTask">

	{{#with data}}
	{{> title title='Задачи' item1='/tasks' item1name='Задачи' item2name=name }}

	<div class="uk-margin-small uk-padding-small" >


		<div class="uk-width-1-1">
			<div class="uk-grid-medium" uk-grid>
				<div class="uk-width-1-4 ">
					<div class="uk-card  uk-margin uk-card-body uk-card-primary">
						<h3 class="uk-margin-remove">{{title}}</h3>
						<h5 class="uk-margin-remove uk-text-small">{{projectname}}</h5>

						<h5 class="uk-margin-small">Менеджер: <span class="uk-float-right">{{> managername id=data.manager}}</span></h5>
						<h5 class="uk-margin-small">Исполнитель: <span class="uk-float-right">{{> managername id=data.developer}}</span></h5>

					</div>


					<div class="uk-card uk-card-default uk-margin-top">
						<div class="uk-card-header">Прогресс</div>
						<div class="timeline list-expandable uk-card-body">
							<h5>Готовность: {{> taskProgress arr=sub}}</h5>

							{{#if $or manager isAdmin}}
								<div class="uk-margin">
									<label class="uk-form-label" for="developer">Исполнитель</label>
									<select  class="uk-select" id="developer">
										<option value="" ></option>
										{{#each managers}}
										<option value="{{_id}}" selected="{{$eq _id data.developer}}">{{name}}</option>
										{{/each}}
									</select>
									<div class="selectize_fix"></div>
								</div>
							{{/if}}


							{{#if $or manager isAdmin}}
								{{#if status}}
									<h5><button id="readyTask" class="uk-button uk-button-primary uk-float-right uk-button-small">Отклонить</button></h5>
								{{else}}
									<h5><button id="readyTask" class="uk-button uk-button-default uk-float-right uk-button-small">Утвердить</button></h5>
								{{/if}}
							{{/if}}

							{{#if developer}}
							{{#unless status}}<h5><button id="readyDevTask" class="uk-button uk-button-primary uk-float-right uk-button-small">Завершить</button></h5>{{/unless}}
							{{/if}}


							{{#if $eq currentUser._id user}}
								{{#if status }}<h5><button id="readyTask" class="uk-button uk-button-default uk-float-right uk-button-small">Отклонить</button></h5>{{/if}}
							{{/if}}

						</div>
					</div>
				</div>


				<div class="uk-width-3-4">

					{{#each sub}}
						<div class="uk-card uk-card-default uk-margin-top">

							<div class="uk-card-header uk-inline uk-width-1-1">
								<h4 class=" ">
									{{#if status}}
									<s>Подзадача от {{subdate date}}</s>
									{{else}}
									Подзадача от {{subdate date}}
									{{/if}}
								</h4>
								{{#if status}}
								Выполненно {{subdate status}}
								{{else}}
								{{> managername id=user}}
								<button class="uk-button uk-button-small uk-button-primary uk-position-right subclose" id="{{@index}}">Завершить</button>
								{{/if}}
							</div>

							<div class="uk-card-body uk-form-stacked">
								{{{text}}}
							</div>
						</div>
					{{/each}}

					{{#unless status}}
					<div class="uk-card uk-card-default uk-margin-top">
						<div class="uk-card-header uk-inline uk-width-1-1">
							<h4 class=" ">
								Добавить подзадачу
							</h4>

							<button class="uk-button uk-button-small uk-button-primary uk-position-right" id="descriptionsave">Cохранить</button>
						</div>

						<div class="uk-card-body uk-form-stacked">
							<div class="uk-form-controls">
								<textarea id="description" cols="30"></textarea>
							</div>
						</div>
					</div>
					<script src="/js/ckeditor/ckeditor.js"></script>
					<script>
						CKEDITOR.replace('description');
					</script>
					{{/unless}}


					<div class="uk-card uk-card-default uk-margin-top uk-hidden">

						<div class="uk-card-header uk-inline uk-width-1-1">
							<h4 class=" ">
								Детали
							</h4>
						</div>

						<div class="uk-card-body uk-form-stacked">
							<div class="uk-grid uk-grid-divider uk-grid-medium" uk-grid>
								<div class="uk-margin uk-width-1-1">
									<h4 class="uk-form-label" for="short">Описание задачи</h4>
										<p>{{teh}}</p>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>


	{{/with}}
</template>
